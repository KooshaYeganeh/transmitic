<html>

<head>
    <title>Shared With Me</title>
    <style>
        @import url(style.css);
    </style>
    <script src="global_transmitic.js"></script>
    <script>

        class SharedData extends Element {

            this(props) {

            }

            render(props) {
                return <div>
                    <h3>{props.owner}</h3>
                    {this.createFileList(props.files, 0, 0)}    
                </div>
            }

            createFileList(files, padding, divID) {
                if (!files) {
                    return "";
                }
                
                let style = "padding-left:" + padding + "em";
                let parentStyle = "display: none;";
                if (divID == 0){
                    parentStyle = "";
                }
                return <div id={divID} style={parentStyle}>
                    
                    { files.map((d) =>  <div style={style}>{this.createFile(d, padding)}</div> )}

                </div>
            }

            createFile(d, padding) {
                let showMore  = "";
                let divID = 0;
                if (d.children) {
                    let childrenLength = d.children.length;
                    if (childrenLength > 2) {
                        divID = Math.random().toString();
                        divID = divID.substring(3, divID.length);
                        showMore = <button style="font-size: 8pt; margin-left: 1em;" class="show-more" div-id={divID}>Show more ({childrenLength})</button>;
                    }
                }
                return <div>{d.path} | {d.count} {d.type} | {d.size} {showMore} <br/> {this.createFileList(d.children, ++padding, divID)}</div>
            }

            ["on click at button.show-more"](evt, btn) {
                let divID = btn.getAttribute("div-id");
                document.$("div#" + divID).style.display = "inline-block";
            }

        }

        class SharedWithMe extends Element {

            refreshState;
            fileData;

            this(props) {
                this.refreshState = "empty";
                this.fileData = [];
            }

            render(props) {
                let contentElements;
                if (this.refreshState === "empty") {
                    contentElements = <div><br />Press Refresh All</div>;
                }
                else if (this.refreshState === "refreshing"){
                    contentElements = <div><br />Please wait. Refreshing...</div>;
                }
                else if (this.refreshState === "finished") {
                    contentElements = <div>{ this.fileData.map((d) => <SharedData owner={d.owner} files={d.files} />) }</div>;
                }
                else {
                    contentElements = <div><br />Error: Unknown refreshState '{this.refreshState}'</div>;
                }
                let finalData = <div>
                    <button id="refresh-all">Refresh All</button>
                    <button id="download-selected">Download Selected</button>
                    {contentElements}
                </div>
                //finalData.appendChild(contentElements);
                return finalData;
            }

            ["on click at button#refresh-all"]() {
                console.log("refresh all pushed");
                this.componentUpdate({refreshState: "refreshing"});
                //let response = Window.this.xcall('refresh_shared_with_me');
                let response = [
                    {
                        owner: "John Smith",
                        files: [
                            {
                                path: "All Files/",
                                count: "1000",
                                size: "1 GB",
                                type: "folder",
                                children: [
                                    {
                                        path: "C:\\path\\hello",
                                        count: "1000",
                                        size: "1 GB",
                                        type: "folder",
                                        children: [
                                            {
                                                path: "C:\\path\\hello\\1.txt",
                                                count: "",
                                                size: "1 MB",
                                                type: "file",
                                            },
                                            {
                                                path: "C:\\path\\hello\\2.txt",
                                                count: "",
                                                size: "1 MB",
                                                type: "file",
                                            },
                                            {
                                                path: "C:\\path\\hello\\3.txt",
                                                count: "",
                                                size: "1 MB",
                                                type: "file",
                                            },                                  
                                            {
                                                path: "C:\\path\\hello",
                                                count: "1000",
                                                size: "1 GB",
                                                type: "folder",
                                                children: [
                                                    {
                                                        path: "C:\\path\\hello\\1.txt",
                                                        count: "",
                                                        size: "1 MB",
                                                        type: "file",
                                                    },
                                                    {
                                                        path: "C:\\path\\hello\\2.txt",
                                                        count: "",
                                                        size: "1 MB",
                                                        type: "file",
                                                    },
                                                    {
                                                        path: "C:\\path\\hello\\3.txt",
                                                        count: "",
                                                        size: "1 MB",
                                                        type: "file",
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    {
                                        path: "C:\\path\\bye.txt",
                                        count: "",
                                        size: "1 MB",
                                        type: "file",
                                    },
                                ]
                            }
                        ]
                    },
                    // {
                    //     owner: "Foo Bar",
                    //     files: [
                    //         {
                    //             path: "All Files/",
                    //             count: "1000",
                    //             size: "1 GB",
                    //             type: "folder",
                    //             children: [
                    //                 {
                    //                     path: "C:\\path\\hello",
                    //                     count: "1000",
                    //                     size: "1 GB",
                    //                     type: "folder",
                    //                     children: [
                    //                         {
                    //                             path: "C:\\path\\hello\\1.txt",
                    //                             count: "",
                    //                             size: "1 MB",
                    //                             type: "file",
                    //                         },
                    //                         {
                    //                             path: "C:\\path\\hello\\2.txt",
                    //                             count: "",
                    //                             size: "1 MB",
                    //                             type: "file",
                    //                         },
                    //                         {
                    //                             path: "C:\\path\\hello\\3.txt",
                    //                             count: "",
                    //                             size: "1 MB",
                    //                             type: "file",
                    //                         },
                    //                     ]
                    //                 },
                    //                 {
                    //                     path: "C:\\path\\bye.txt",
                    //                     count: "",
                    //                     size: "1 MB",
                    //                     type: "file",
                    //                 },
                    //             ]
                    //         }
                    //     ]
                    // }
                ];
                this.componentUpdate({fileData: response, refreshState: "finished"});
            }

        }

        document.$("div#shared-with-me").content(<SharedWithMe />);

    </script>
</head>

<body>
    <div class="main-body" selectable>

        <h1>
            Shared With Me
        </h1>

        <div id="shared-with-me">

        </div>

        <button>Refresh All</button>
        <button>Download Selected (18)</button>

        <br><br>

        <h3>John Smith</h3>
        <button style="font-size: 9pt;">Refresh</button> &nbsp;&nbsp;Currently Offline. Could not refresh.
        <br><br>
        <button type="checkbox">All Files | 1000 files | 1.68 GB</button>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="checkbox">C:\Users\foobar | Folder (300 files) | 1.5
            GB</button><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button
            type="checkbox">C:\Users\foobar | Folder | 1.5 GB</button><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button
            type="checkbox">C:\Users\foobar | Folder | 1.5 GB</button><br>

        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="checkbox">C:\Users\foobar | Folder (300 files) | 1.5
            GB</button> <span style="background: #333; font-size: 8pt; padding: 5dip; display: inline-block;">Show More
            ( 12,000 )</span> <br>

        <br><br>

        <hr>

    </div>
</body>
</html>